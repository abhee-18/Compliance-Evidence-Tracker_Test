<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Evidence Tracker</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

    <!-- AOS -->
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">

    <!-- Excel Export Library -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #eef2ff, #f8fafc);
            min-height: 100vh;
        }

        .header {
            padding: 35px 20px;
            text-align: center;
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }

        .header h1 {
            color: #1e293b;
            font-weight: 600;
        }

        .header p {
            color: #64748b;
            margin-top: 6px;
        }

        .container {
            padding: 40px 8%;
        }

        .form-card {
            background: white;
            padding: 25px;
            border-radius: 14px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.06);
            margin-bottom: 40px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        input,
        select {
            width: 100%;
            padding: 12px;
            border-radius: 10px;
            border: 1px solid #e2e8f0;
            font-family: 'Poppins', sans-serif;
        }

        .btn {
            padding: 10px 18px;
            background: linear-gradient(135deg, #4f46e5, #06b6d4);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 500;
            margin-right: 10px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 14px;
            overflow: hidden;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.06);
        }

        th {
            background: #f1f5f9;
            padding: 14px;
            text-align: left;
            font-size: 14px;
        }

        td {
            padding: 14px;
            border-top: 1px solid #f1f5f9;
            font-size: 14px;
        }

        .delete-btn {
            background: #fee2e2;
            color: #b91c1c;
            border: none;
            padding: 6px 10px;
            border-radius: 8px;
            cursor: pointer;
        }

        html {
            scroll-behavior: smooth;
        }
    </style>
</head>

<body>

    <div class="header">
        <h1>Evidence Tracker</h1>
        <p>Track SOC 2 / ISO 27001 Audit Evidence</p>
    </div>

    <div class="container">

        <div class="form-card">
            <h3 style="margin-bottom:15px;">Add New Control</h3>

            <div class="form-group">
                <input type="text" id="controlName" placeholder="Control Name">
            </div>

            <div class="form-group">
                <select id="category">
                    <option value="">Select Category</option>
                    <option>Access Review</option>
                    <option>Change Management</option>
                    <option>Incident Logs</option>
                    <option>Backups</option>
                    <option>Vendor Compliance</option>
                </select>
            </div>

            <div class="form-group">
                <select id="status">
                    <option value="Pending">Pending</option>
                    <option value="Collected">Collected</option>
                </select>
            </div>

            <button class="btn" onclick="addControl()">Add Control</button>
            <button class="btn" onclick="exportToExcel()">Export to Excel</button>
        </div>

        <table>
            <thead>
                <tr>
                    <th>Control Name</th>
                    <th>Category</th>
                    <th>Status</th>
                    <th>Evidence</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="trackerTable"></tbody>
        </table>

    </div>

    <script>
        const STORAGE_KEY = "evidenceTrackerControls";

        function getControls() {
            return JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
        }

        function saveControls(data) {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
        }

        function addControl() {
            const name = document.getElementById("controlName").value;
            const category = document.getElementById("category").value;
            const status = document.getElementById("status").value;

            if (!name || !category) {
                alert("Please fill all fields");
                return;
            }

            const controls = getControls();

            controls.push({
                id: Date.now(),
                name,
                category,
                status,
                evidenceName: ""
            });

            saveControls(controls);
            document.getElementById("controlName").value = "";
            document.getElementById("category").value = "";
            loadControls();
        }

        function loadControls() {
            const table = document.getElementById("trackerTable");
            table.innerHTML = "";

            const controls = getControls();

            controls.forEach((data) => {
                const row = table.insertRow();

                row.insertCell(0).innerText = data.name;
                row.insertCell(1).innerText = data.category;

                const statusCell = row.insertCell(2);
                const select = document.createElement("select");
                ["Pending", "Collected"].forEach((s) => {
                    const opt = document.createElement("option");
                    opt.value = s;
                    opt.text = s;
                    if (data.status === s) opt.selected = true;
                    select.appendChild(opt);
                });
                select.onchange = () => updateStatus(data.id, select.value);
                statusCell.appendChild(select);

                const evidenceCell = row.insertCell(3);
                const fileInput = document.createElement("input");
                fileInput.type = "file";
                fileInput.onchange = (e) => saveLocalEvidence(data.id, e.target.files[0]);
                evidenceCell.appendChild(fileInput);

                if (data.evidenceName) {
                    const nameTag = document.createElement("div");
                    nameTag.innerText = "ðŸ“„ " + data.evidenceName;
                    nameTag.style.fontSize = "12px";
                    nameTag.style.marginTop = "6px";
                    evidenceCell.appendChild(nameTag);
                }

                const actionCell = row.insertCell(4);
                const delBtn = document.createElement("button");
                delBtn.innerText = "Delete";
                delBtn.className = "delete-btn";
                delBtn.onclick = () => deleteControl(data.id);
                actionCell.appendChild(delBtn);
            });
        }

        function updateStatus(id, newStatus) {
            const controls = getControls().map(c =>
                c.id === id ? { ...c, status: newStatus } : c
            );
            saveControls(controls);
        }

        function deleteControl(id) {
            if (!confirm("Delete this control?")) return;
            const controls = getControls().filter(c => c.id !== id);
            saveControls(controls);
            loadControls();
        }

        function saveLocalEvidence(id, file) {
            if (!file) return;
            const controls = getControls().map(c =>
                c.id === id ? { ...c, evidenceName: file.name } : c
            );
            saveControls(controls);
            loadControls();
        }

        function exportToExcel() {
            const controls = getControls();
            if (controls.length === 0) {
                alert("No data to export");
                return;
            }

            const exportData = controls.map(c => ({
                "Control Name": c.name,
                "Category": c.category,
                "Status": c.status,
                "Evidence File": c.evidenceName || "Not Attached"
            }));

            const worksheet = XLSX.utils.json_to_sheet(exportData);
            const workbook = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(workbook, worksheet, "Evidence Tracker");

            XLSX.writeFile(workbook, "Evidence_Tracker.xlsx");
        }

        window.addEventListener("load", loadControls);
    </script>

</body>

</html>
